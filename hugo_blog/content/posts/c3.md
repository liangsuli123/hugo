---
title: " docker常用命令 "
date: 2018-10-10T14:26:00+08:00
draft: false
tags: ["网络协议"]
slug: "C3"
---

```
1、docker镜像管理常用命令

　　　　　　docker help                           # 查看docker帮助

　　　　　　docker image --help              # 查看 docker中 镜像相关帮助

　　　　　　docker image ls                    # 查看当前所有镜像

　　　　　　docker image inspect nginx             # 查看指定镜像（nginx镜像）详细信息

　　　　　　docker pull nginx:1.14                      # 下载指定版本镜像 nginx

　　　　　　docker image rm nginx:1.14            # 删除nginx 1.14版本

　　　　　　docker image save nginx > nginx.tar           # 导出niginx镜像

　　2、docker创建容器常用命令

　　　　　　docker run --help                                # 查看创建容器帮助

　　　　　　docker run -it centos                           # 创建centos镜像并进入终端

　　　　　　docker run -d nginx                             # 后台启动nginx容器

　　　　　　docker stop 6bb09dce461f                 # 关闭一个容器

　　　　　　docker ps -l                                         # 查看最近运行的容器

　　　　　　docker run -itd centos                         # 启用一个伪终端守护centos容器

　　　　　　docker container run -d --name web3 -e test=123456 -p 8800:80 -h webhostname --restart always nginx
　　　　　　　　　　-d                                                # 后台启动nginx容器
　　　　　　　　　　--name web3                              # 自定义容器名字(默认会是一段随机字符串)
　　　　　　　　　　-e test=123456                           # 启动容器添加变量 test=123456 (echo $test)
　　　　　　　　　　-p 8800:80                                  # 宿主机的8800端口映射到docker容器的80端口中
　　　　　　　　　　-h webhostname                         # docker容器主机名 (a300f394af88)
　　　　　　　　　　--restart always                           # 宿主机重启自动拉起这个docker容器
　　　　　　　　　　nginx                                           # 使用这个nginx镜像启动容器

　　　　　　　　　　注：http://192.168.56.12:8800/     访问这个docker  nginx

　　　　　　docker logs web                                         # 查看上面启动的web容器的日志

　　　　　　docker exec -it web bash                           # 进入容器web

　　3、容器资源限制

　　　　1. 内存限额： 允许容器最多使用500M内存和100M的Swap，并禁用 OOM Killer

　　　　　　　　docker run -d --name nginx03 --memory="500m" --memory-swap="600m" --oom-kill-disable nginx

　　　　2. CPU限额：

　　　　　　　　docker run -d --name nginx04 --cpus="1.5" nginx           # 允许容器最多使用一个半的CPU

　　　　　　　　docker run -d --name nginx05 --cpus=".5" nginx            # 允许容器最多使用50%的CPU

　　4、docker管理容器常用命令

　　　　　　　　docker ps                 # 仅列出当前运行的容器
　　　　　　　　docker ps -l              # 列出最新创建得容器
　　　　　　　　docker ps -a             # 列出素有容器(包括 未运行的)

　　　　　　　　docker inspect web4                   # 列出指定容器的详细信息

　　　　　　　　#### 持久化容器

　　　　　　　　docker exec -it web4 bash                                # 进入容器web4中
　　　　　　　　touch 1.txt 2.txt                                                 # 对容器进行修改
　　　　　　　　docker commit web4 nginx:web4                     # 将修改后的web4容器提交为一个新镜像 nginx:web4
　　　　　　　　docker images                                                  # 可以看到 多了一个 TAG标记为 web4 的镜像
　　　　　　　　docker run -d --name web4-1 nginx:web4        # 使用刚刚提交的镜像web4创建一个容器web4-1
　　　　　　　　docker exec -it web4-1 bash                             # 进入web4-1的bash环境

　　　　　　　　#### 从宿主机复制文件到docker容器
　　　　　　　　docker cp nginx.tar web4-1:/home                    # 将宿主机nginx.tar文件拷贝到容器web4-1的/home目录中
　　　　　　　　docker exec -it web4-1 ls /home                       # 在容器web4-1中执行 "ls /home" 命令

　　　　　　　　#### 容器常用查询命令
　　　　　　　　docker logs web4-1                                           # 查看web4-1中控制台日志
　　　　　　　　docker port 55f870061ed9                                 # 查看指定容器端口映射
　　　　　　　　docker top 00f7ddc96622                                  # 查看容器中有哪些进程
　　　　　　　　docker stats 00f7ddc96622                               # 查看容器资源使用情况

　　　　　　　　##### 启动、停止、删除 容器
　　　　　　　　docker ps -a                                                     # 列出素有容器(包括 未运行的)
　　　　　　　　docker start web                                               # 启动容器web　　　　　　
　　　　　　　　docker stop web                                               # 停止容器web
　　　　　　　　docker rm web

1.5 docker将数据挂载到容器的三种方式　
　　1、Docker提供三种方式将数据从宿主机挂载到容器中

　　　　　　1）volumes：Docker管理宿主机文件系统的一部分（/var/lib/docker/volumes） 保存数据的最佳方式。

　　　　　　2）bind mounts：将宿主机上的任意位置的文件或者目录挂载到容器中， 就像软连接一样。

　　　　　　3）tmpfs：挂载存储在主机系统的内存中，而不会写入主机的文件系统（不常用）。

　　2、管理卷
　　　　　　　　docker volume create nginx-vol                            # 创建一个数据卷 nginx-vol

　　　　　　　　docker volume ls                                                   # 查看宿主机数据卷信息

　　　　　　　　docker volume inspect nginx-vol                           # 查看 nginx-vol 这个数据卷详细信息

　　　　　　　　ls /var/lib/docker/volumes/nginx-vol/_data            # 详细信息中会显示 nginx-vol 这个卷实际在宿主机位置

　　　　　　　　docker rm -f $(docker ps -a |awk '{print $1}')        # 删除所有容器

　　3、volumes：将容器中的数据持久化到宿主机中

　　　　1）用卷创建一个容器：

　　　　　　　　docker run -d --name=nginx-test -p 88:80 --mount src=nginx-vol,dst=/usr/share/nginx/html nginx
　　　　　　　　　　　　run -d                                                 # 后台启动一个nginx容器
　　　　　　　　　　　　--name=nginx-test                             # 自定义容器名字(默认会是一段随机字符串)
　　　　　　　　　　　　-p  88:80                                             # 将宿主机的88端口映射到容器的80端口
　　　　　　　　　　　　--mount 
　　　　　　　　　　　　　　src=nginx-vol,                               # 挂载数据卷名称nginx-vol
　　　　　　　　　　　　　　dst=/usr/share/nginx/html             # 将/usr/share/nginx/html文件挂载到nginx-vol数据卷中
　　　　　　　　　　　　nginx                                                     # 使用这个nginx镜像启动容器

　　　　　　　　vim /var/lib/docker/volumes/nginx-vol/_data/index.html       # 修改nginx的 index.html文件可以发现页面发生改变

　　　　　　　　http://192.168.56.12:88/

　　　　2）清理卷：
　　　　　　　　docker stop nginx-test                                     # 关闭正在使用卷nginx-vol的容器nginx-test
　　　　　　　　docker rm nginx-test                                       # 删除容器 nginx-test
　　　　　　　　docker volume rm nginx-vol                            # 删除卷 nginx-vol

　　4、bind mounts：将宿主机中的数据挂载到容器中

　　　　1）用卷创建一个容器：

　　　　　　　　docker run -d --name=nginx-test -p 88:80 --mount type=bind,src=/mnt/,dst=/usr/share/nginx/html nginx
　　　　　　　　　　　　run -d                                                  # 后台启动一个nginx容器
　　　　　　　　　　　　--name=nginx-test                              # 自定义容器名字(默认会是一段随机字符串)
　　　　　　　　　　　　-p  88:80                                              # 将宿主机的88端口映射到容器的80端口
　　　　　　　　　　　　--mount type=bind                              # 将/usr/share/nginx/html文件夹挂载到宿主机/mnt/文件夹中
　　　　　　　　　　　　　　src=/mnt/,                                   # 宿主机中挂载目录 /mnt/
　　　　　　　　　　　　　　dst=/usr/share/nginx/html           # 容器中/usr/share/nginx/html文件夹
　　　　　　　　　　　　nginx                                                 # 使用这个nginx镜像启动容器

　　　　　　　　docker exec -it nginx-test bash                       # 进入容器
　　　　　　　　cd /usr/share/nginx/html                                  # 进入容器的挂载目录
　　　　　　　　echo "hello I come here" > index.html            # 在目录中创建一个 index.html文件
　　　　　　　　http://192.168.56.12:88/                                  # 可以在页面访问到 index.html首页

　　　　　　　　vim /mnt/index.html                                         # 修改 /mnt/index.html 就等同修改容器中的index.html页面

 　　　　2）清理：
　　　　　　　　docker stop nginx-test                                     # 关闭正在使用卷nginx-vol的容器nginx-test
　　　　　　　　docker rm nginx-test                                       # 删除容器 nginx-test

　　　　注意：
　　　　　　　　1. 如果源文件/目录没有存在，不会自动创建，会抛出一个错误。
　　　　　　　　2. 如果挂载目标在容器中非空目录，则该目录现有内容将被隐藏。

　　5、Volume特点：
　　　　　　1. 多个运行容器之间共享数据。
　　　　　　2. 当容器停止或被移除时，该卷依然存在。
　　　　　　3. 多个容器可以同时挂载相同的卷。
　　　　　　4. 当明确删除卷时，卷才会被删除。
　　　　　　5. 将容器的数据存储在远程主机或其他存储上
　　　　　　6. 将数据从一台Docker主机迁移到另一台时，先停止容器，然后备份卷的目录（/var/lib/docker/volumes/）

　　6、Bind Mounts特点：
　　　　　　1. 从主机共享配置文件到容器。默认情况下，挂载主机/etc/resolv.conf到每个容器，提供DNS解析。
　　　　　　2. 在Docker主机上的开发环境和容器之间共享源代码。例如，可以将Maven target目录挂载到容器中，每次在Docker主机
　　　　　　    上构建Maven项目时，容器都可以访问构建的项目包。
　　　　　　3. 当Docker主机的文件或目录结构保证与容器所需的绑定挂载一致时

 1.6 容器网络
 　　1、网络模式

　　　　• bridge（常用）
　　　　　　　　–net=bridge
　　　　　　　　默认网络，Docker启动后创建一个docker0网桥，默认创建的容器也是添加到这个网桥中。
　　　　• host（常用）
　　　　　　　　–net=host
　　　　　　　　容器不会获得一个独立的network namespace，而是与宿主机共用一个。这就意味着容器不会有自己的网卡信息，而是使用宿主
　　　　　　　　机的。容器除了网络，其他都是隔离的。
　　　　• none（不常用）
　　　　　　　　–net=none
　　　　　　　　获取独立的network namespace，但不为容器进行任何网络配置，需要我们手动配置。
　　　　• container（不常用）
　　　　　　　　–net=container:Name/ID
　　　　　　　　与指定的容器使用同一个network namespace，具有同样的网络配置信息，两个容器除了网络，其他都还是隔离的。
　　　　• 自定义网络（最佳方式）
　　　　　　　　与默认的bridge原理一样，但自定义网络具备内部DNS发现，可以通过容器名或者主机名容器之间网络通信。
```